#Docs: https://wiki.metacubex.one/config/
#Date: 2025.10.16
#Author: Sit

# 全局配置
## 允许局域网
allow-lan: true
bind-address: "*"
lan-allowed-ips:
  - 0.0.0.0/0
  - ::/0
lan-disallowed-ips: []
### 用户验证
authentication:
  - schroe:hyperapp
skip-auth-prefixes:
  - 127.0.0.1/32
  - ::1/128
## 运行模式
mode: rule
## 日志级别
log-level: info
## IPv6
ipv6: true
## TCP Keep Alive 设置
keep-alive-interval: 30
keep-alive-idle: 600
disable-keep-alive: false
## 进程匹配模式
find-process-mode: strict
## 外部控制 (API)
external-controller: 0.0.0.0:9090
#external-controller-cors:
#  allow-origins:
#    - '*'
#  allow-private-network: true
#external-controller-unix: mihomo.sock
#external-controller-pipe: \\.\pipe\mihomo
#external-controller-tls: 127.0.0.1:9443
#external-doh-server: /dns-query
secret: hyperapp
## 外部用户界面
external-ui: ui
## 自定义外部用户界面名字
external-ui-name: metacubexd
## 自定义外部用户界面下载地址
external-ui-url: https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip
## 缓存
profile:
  store-selected: true
  store-fake-ip: true
## 统一延迟
unified-delay: true
## TCP 并发
tcp-concurrent: true
## 出站接口
#interface-name: en0
## 路由标记
#routing-mark: 6666
## TLS
#tls:
#  certificate: string # 证书 PEM 格式，或者 证书的路径
#  private-key: string # 证书对应的私钥 PEM 格式，或者私钥路径
#  ech-key: |-
#    -----BEGIN ECH KEYS-----
#    ACATwY30o/RKgD6hgeQxwrSiApLaCgU+HKh7B6SUrAHaDwBD/g0APwAAIAAgHjzK
#    madSJjYQIf9o1N5GXjkW4DEEeb17qMxHdwMdNnwADAABAAEAAQACAAEAAwAIdGVz
#    dC5jb20AAA==
#    -----END ECH KEYS-----
#  # ECH 密钥，如果填写则会启用 ECH
## 全局客户端指纹
global-client-fingerprint: chrome
## GEOIP 数据模式
geodata-mode: false
## GEO 文件加载模式
geodata-loader: standard
## 自动更新 GEO
geo-auto-update: true
geo-update-interval: 24
## 自定 GEO 下载地址
geox-url:
  geoip: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat
  geosite: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
  mmdb: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.metadb
  asn: https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb
## 自定全局 UA
#global-ua: clash.meta
## ETag 支持
#etag-support: true

# DNS
dns:
  enable: true
  #cache-algorithm: lru
  prefer-h3: false
  listen: 0.0.0.0:7874
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - +.lan
    - +.local
    - localhost
    - localhost.*.qq.com
    - localhost.*.weixin.qq.com
    - +.direct
    - cable.auth.com
    - +.msftconnecttest.com
    - +.msftncsi.com
    - detectportal.firefox.com
    - network-test.debian.org
    - resolver1.opendns.com
    - injections.adguard.org
    - local.adguard.org
    - pool.ntp.org
    - +.pool.ntp.org
    - +.ntp.org.cn
    - ntp.*.com
    - ntp?.*.com
    - time.*.com
    - time?.*.com
    - time.*.edu.cn
    - time.*.gov
    - stun.*
    - global.stun.twilio.com
    - global.turn.twilio.com
    - PDC._msDCS.*.*
    - DC._msDCS.*.*
    - GC._msDCS.*.*
    - +.cmpassport.com
    - +.10099.com.cn
    - id6.me
    - open.e.189.cn
    - mdn.open.wo.cn
    - opencloud.wostore.cn
    - auth.wosms.cn
    - auth.wostore
    - +.jegotrip.com.cn
    - +.icitymobile.mobi
    - +.cmbchina.com
    - +.pingan.com.cn
    - +.douyinvod.com
    - +.douyinliving.com
    - +.amemv.com
    - +.douyincdn.com
    - +.live.bilibili.com
    - +.bilivideo.com
    - +.bilivideo.cn
    - +.mcdn.bilivideo.cn
    - geosite:private
    - geosite:cn
  fake-ip-filter-mode: blacklist
  use-hosts: true
  use-system-hosts: false
  respect-rules: false
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.144
    - 180.76.76.76
    - 1.2.4.8
  nameserver-policy: {}
  proxy-server-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.144
    - 180.76.76.76
    - 1.2.4.8
  direct-nameserver: []
  #direct-nameserver-follow-policy: false
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.144
    - 180.76.76.76
    - 1.2.4.8 
  fallback:
    - 8.8.8.8
    - 8.8.4.4
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32
    domain:
      - +.google.com
      - +.facebook.com
      - +.youtube.com

# hosts
hosts:
  91.108.56.100: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.101: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.104: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.107: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.125: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.126: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.128: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  91.108.56.156: [91.108.56.147, 91.108.56.135, 91.108.56.130]
  iosapps.itunes.apple.com: iosapps.itunes.apple.com.download.ks-cdn.com
  updates.g.aaplimg.com: updates.cdn-apple.com.download.ks-cdn.com

# 域名嗅探
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: false
  sniff:
    HTTP:
      ports:
        - 80
        - 8080-8880
      override-destination: true
    TLS:
      ports:
        - 443
        - 8443
    QUIC:
      ports:
        - 443
        - 8443
  force-domain:
    - +.v2ex.com
  skip-domain:
    - dlg.io.mi.com
    - +.push.apple.com
    - +.apple.com
  skip-src-address: []
  skip-dst-address:
    - 91.105.192.0/23
    - 91.108.4.0/22
    - 91.108.8.0/21
    - 91.108.16.0/21
    - 91.108.56.0/22
    - 95.161.64.0/20
    - 149.154.160.0/20
    - 185.76.151.0/24
    - 2001:67c:4e8::/48
    - 2001:b28:f23c::/47
    - 2001:b28:f23f::/48
    - 2a0a:f280:203::/48

# 代理端口
## http(s) 代理端口
port: 7890
## socks4/4a/5 代理端口
socks-port: 7891
## 混合端口
mixed-port: 7892
## 透明代理端口¶
redir-port: 7893
tproxy-port: 7894

# Tun
tun:
  enable: true
  stack: mixed
  device: utun1500
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  dns-hijack:
    - any:53
    - tcp://any:53
  strict-route: true
  mtu: 9000
  #gso: true
  #gso-max-size: 65536
  #udp-timeout: 300
  #iproute2-table-index: 2022
  #iproute2-rule-index: 9000
  #endpoint-independent-nat: false
  #route-address-set:
  #  - ruleset-1
  #  - ruleset-2
  #route-address:
  #  - 0.0.0.0/1
  #  - 128.0.0.0/1
  #  - "::/1"
  #  - "8000::/1"
  route-exclude-address: 
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
    - 255.255.255.255/32
    - 100.64.0.0/10
    - 127.0.0.0/8
    - 169.254.0.0/16
    - 192.0.0.0/24
    - 192.0.2.0/24
    - 192.88.99.0/24
    - 198.51.100.0/24
    - 203.0.113.0/24
    - 224.0.0.0/4
    - ::1/128
    - fe80::/10
    - fc00::/7
    - fd00::/8
    - ff00::/8
  #include-interface:
  #- eth0
  #exclude-interface:
  #- eth1
  #include-uid:
  #- 0
  #include-uid-range:
  #- 1000:9999
  #exclude-uid:
  #- 1000
  #exclude-uid-range:
  #- 1000:9999
  #include-android-user:
  #- 0
  #- 10
  #include-package:
  #- com.android.chrome
  #exclude-package:
  #- com.android.captiveportallogin


## --------------------以上为核心配置-------------------- ##

## --------------------以下为个人配置-------------------- ##

# 锚点，用于简化配置
# for proxy-providers
pp: &pp {type: http, interval: 86400, proxy: DIRECT, "health-check": {enable: true, url: http://www.gstatic.com/generate_204, interval: 300}}
# for proxy-groups 
pg_fb: &pg_fb {type: fallback, url: http://www.gstatic.com/generate_204, tolerance: 20, interval: 300}
pg_ut: &pg_ut {type: url-test, url: http://www.gstatic.com/generate_204, tolerance: 20, interval: 300}
# for rule-providers
ip_mrs: &ip_mrs {type: http, interval: 86400, behavior: ipcidr, format: mrs}
domain_mrs: &domain_mrs {type: http, interval: 86400, behavior: domain, format: mrs}
domain_yaml: &domain_yaml {type: http, interval: 86400, behavior: domain, format: yaml}
class_yaml: &class_yaml {type: http, interval: 86400, behavior: classical, format: yaml}
# 机场代理地址
proxy-providers:  
  Proxies: {<<: *pp, url: ""}
  SS+TLS: {<<: *pp, url: ""}
# 机场代理策略组分组
proxy-groups:
  - {name: Global, type: select, proxies: [HK, JP, US, SG, TW, UN, DIRECT, Proxies], use: [SS+TLS]}
  - {name: Telegram, type: select, proxies: [SG, Global, HK, JP, US, TW]}
  - {name: AI, type: select, proxies: [US, Global, HK, JP, SG, TW]}
  - {name: VPS, type: select, proxies: [DIRECT, Global, HK, JP, US, SG, TW, UN]}
  - {name: Emby, type: select, proxies: [DIRECT, 实验线路0.2X, Global], use: [SS+TLS]}
  - {name: Apple, type: select, proxies: [DIRECT, Global, HK, JP, US, SG, TW]}
  - {name: OneDrive, type: select, proxies: [DIRECT, Global]}
  - {name: Speedtest, type: select, proxies: [DIRECT, HK, JP, US, SG, TW, UN, 高级线路, 标准线路, 实验线路0.2X, Proxies], use: [SS+TLS]}
  - {name: Final, type: select, proxies: [DIRECT, Global, REJECT]}
  - {name: UN, type: select, filter: "^(?!.*?(香港|日本|新加坡|美国|台湾|实验)).*(标准)", use: [Proxies]}
  - {name: HK, <<: *pg_ut, filter: "香港", use: [Proxies]}
  - {name: JP, <<: *pg_ut, filter: "日本", use: [Proxies]}
  - {name: US, <<: *pg_ut, filter: "美国", use: [Proxies]}
  - {name: SG, <<: *pg_ut, filter: "新加坡", use: [Proxies]}
  - {name: TW, <<: *pg_ut, filter: "台湾", use: [Proxies]}
  - {name: 高级线路, filter: "高级", type: select, use: [Proxies]} 
  - {name: 标准线路, filter: "标准", type: select, use: [Proxies]} 
  - {name: 实验线路0.2X, filter: "实验", type: select, use: [Proxies]} 
  - {name: Proxies, type: select, use: [Proxies]} 
# 规则订阅
rule-providers:
  OpenAI: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/OpenAI.yaml"} 
  Copilot: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Copilot.yaml"}
  Gemini: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Gemini.yaml"}
  Claude: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Claude.yaml"}
  Lan: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Lan.yaml"}
  Fix: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Direct.yaml"}
  Bing: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Bing.yaml"}
  Apple: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Apple.yaml"}
  OneDrive: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/OneDrive.yaml"}
  GoogleVoice: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/GoogleVoice.yaml"}
  Telegram: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Telegram.yaml"}
  Speedtest: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Speedtest.yaml"}
  WeChat: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/WeChat.yaml"}
  IPTVMainland: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/IPTVMainland.yaml"}
  ChinaMax: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/ChinaMax.yaml"}
  IPTVOther: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/IPTVOther.yaml"}
  Global: {<<: *class_yaml, url: "https://rule.kelee.one/Clash/Global.yaml"}
# 规则
rules:
  # JavBus
  - DOMAIN-SUFFIX, dmm.co.jp, JP
  - DOMAIN-SUFFIX, mgstage.com, JP
  - DOMAIN-SUFFIX, javbus.com, Global
  - DOMAIN-SUFFIX, javbus22.com, Global
  - DOMAIN-SUFFIX, missav.com, Global
  - DOMAIN-SUFFIX, eightcha.com, Global
  - DOMAIN-SUFFIX, javdb.com, Global
  - DOMAIN-SUFFIX, jable.tv, Global
  - DOMAIN-SUFFIX, avgle.com, Global
  - DOMAIN-SUFFIX, javlibrary.com, Global
  - DOMAIN-SUFFIX, jav.guru, Global
  - DOMAIN-SUFFIX, netflav.com, Global
  - DOMAIN-SUFFIX, javday.tv, Global
  # Emby
  - DOMAIN-SUFFIX, uhdnow.com, Emby
  # 白名单
  - DOMAIN, update.code.visualstudio.com, DIRECT
  - DOMAIN-SUFFIX, msecnd.net, DIRECT
  - DOMAIN-SUFFIX, rztcd.com, DIRECT
  - DOMAIN-SUFFIX, cddyjy.com, DIRECT
  - DOMAIN-SUFFIX, bendibao.com, DIRECT
  - DOMAIN-SUFFIX, cdrcbank.com, DIRECT
  - DOMAIN-SUFFIX, splashtop.com, DIRECT
  # 黑名单
  - DOMAIN, connect.garmin.com, Global
  - DOMAIN, sso.garmin.com, Global
  - DOMAIN-SUFFIX, mailjet.com, Global
  - DOMAIN-SUFFIX, proton.me, Global
  - DOMAIN-SUFFIX, oplist.org, Global
  - DOMAIN-SUFFIX, openlist.team, Global
  - DOMAIN-SUFFIX, readest.com, Global
  - DOMAIN-SUFFIX, mcp.so, Global
  - DOMAIN-SUFFIX, nsloon.app, Global
  - DOMAIN-SUFFIX, kelee.one, Global
  - DOMAIN-SUFFIX, annas-archive.org, Global
  - DOMAIN-SUFFIX, firefly-iii.org, Global
  - DOMAIN-SUFFIX, allinhub.dpdns.org, Global
  - DOMAIN-SUFFIX, amysecure.com, Global
  - DOMAIN-SUFFIX, paopao.dog, Global
  - DOMAIN-SUFFIX, api-flowercloud.com, Global
  - DOMAIN-SUFFIX, rutracker.org, Global
  - DOMAIN-SUFFIX, linux.do, Global
  # > VPS
  - IP-CIDR, 130.162.131.186/32, VPS, no-resolve
  # > AI
  - RULE-SET, OpenAI, AI
  - RULE-SET, Copilot, AI
  - RULE-SET, Gemini, AI
  - RULE-SET, Claude, AI
  # 局域网
  - RULE-SET, Lan, DIRECT
  # 后续规则修正
  - RULE-SET, Fix, DIRECT
  # Bing
  - RULE-SET, Bing, DIRECT
  # Apple
  - RULE-SET, Apple, Apple
  # Onedrive
  - RULE-SET, OneDrive, OneDrive
  # GoogleVoice
  - RULE-SET, GoogleVoice, US
  # Telegram
  - RULE-SET, Telegram, Telegram
  # Speedtest
  - RULE-SET, Speedtest, Speedtest
  # 微信
  - RULE-SET, WeChat, DIRECT
  # China
  - RULE-SET, IPTVMainland, DIRECT
  - RULE-SET, ChinaMax, DIRECT
  # Global
  - RULE-SET, IPTVOther, Global
  - RULE-SET, Global, Global
  - MATCH, Final
